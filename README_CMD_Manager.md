# CMD脚本管理器

一个基于Python Flask的专业Web界面CMD脚本管理系统，支持7×24小时运行监控、自动重启、远程控制等功能。

## ✨ 主要功能

### 🎯 核心特性
- **Web界面管理**: 美观专业的响应式Web界面
- **实时监控**: 实时显示脚本运行状态、进程ID、启动时间等
- **自动启动**: 服务启动时自动启动所有已启用的脚本
- **自动重启**: 脚本异常退出后自动尝试重新启动
- **远程控制**: 通过Web界面远程启动、停止、重启脚本
- **分组管理**: 支持脚本分组管理，拖拽操作，分组视图切换
- **日志查看**: 实时查看脚本输出日志，支持多种行数选择
- **批量操作**: 支持批量启动、停止所有脚本
- **状态统计**: 实时统计运行中、已停止、自动重启脚本数量

### 🛠️ 管理功能
- **脚本配置**: 添加、删除、编辑脚本配置
- **启用/禁用**: 灵活控制脚本的启用状态
- **工作目录**: 为每个脚本指定独立的工作目录
- **自动重启**: 可单独配置每个脚本的自动重启策略
- **分组管理**: 创建、编辑、删除脚本分组，支持拖拽移动脚本
- **视图切换**: 支持列表视图和分组视图的灵活切换
- **描述信息**: 为脚本添加详细描述便于管理

### 🎨 界面特色
- **现代化设计**: 采用Bootstrap 5框架，界面美观专业
- **响应式布局**: 完美适配桌面、平板、手机等设备
- **实时更新**: 自动刷新脚本状态，无需手动刷新页面
- **状态指示**: 直观的颜色和图标显示脚本运行状态
- **操作反馈**: Toast通知提供即时的操作反馈

## 🚀 快速开始

### 环境要求
- Windows 10/11 或 Windows Server
- Python 3.7 或更高版本
- 网络浏览器（推荐Chrome、Firefox、Edge）

### 安装步骤

1. **下载代码**
   ```bash
   # 将所有文件放置到您的工作目录中
   # 例如: d:\下载\n1111\
   ```

2. **一键启动**
   ```bash
   # 双击运行启动脚本
   start_cmd_manager.bat
   ```
   
   启动脚本会自动：
   - 检查Python环境
   - 创建虚拟环境
   - 安装所需依赖
   - 启动Web服务
   - 自动启动所有已启用的脚本

3. **访问Web界面**
   ```
   打开浏览器访问: http://localhost:5009
   ```

### 手动安装（可选）

如果需要手动安装，请按以下步骤操作：

```bash
# 1. 创建虚拟环境
python -m venv venv

# 2. 激活虚拟环境
venv\Scripts\activate

# 3. 安装依赖
pip install -r requirements_cmd_manager.txt

# 4. 启动服务
python cmd_manager.py
```

## 📖 使用指南

### 添加脚本

1. 点击「添加脚本」按钮
2. 填写脚本信息：
   - **脚本ID**: 唯一标识符（只能包含字母、数字、下划线）
   - **脚本名称**: 显示名称
   - **执行命令**: 要执行的CMD命令
   - **工作目录**: 脚本运行的工作目录（可选）
   - **描述**: 脚本的详细说明（可选）
   - **自动重启**: 是否在异常退出后自动重启
   - **立即启用**: 是否立即启用该脚本

### 脚本管理

- **启动/停止**: 点击对应按钮控制脚本运行
- **查看日志**: 实时查看脚本输出，支持选择显示行数
- **启用/禁用**: 控制脚本是否参与自动管理
- **删除脚本**: 永久删除脚本配置（需确认）

### 分组管理

- **创建分组**: 点击「创建分组」按钮，填写分组ID、名称和描述
- **分组视图**: 切换到分组视图，查看按分组组织的脚本
- **拖拽移动**: 启用拖拽功能后，可将脚本拖拽到不同分组
- **编辑分组**: 点击分组标题旁的编辑按钮修改分组信息
- **删除分组**: 删除分组时，其中的脚本会移动到未分组区域

### 批量操作

- **启动全部**: 启动所有已启用且未运行的脚本
- **停止全部**: 停止所有正在运行的脚本

### 自动启动功能

系统启动时会自动启动所有已启用的脚本：
- 默认情况下，所有脚本都会自动启动
- 如需禁用某个脚本的自动启动，可在配置文件中设置 `"enabled": false`
- 启动过程中会显示每个脚本的启动状态和结果统计

### 监控功能

系统会自动监控所有已启用的脚本：
- 每3秒检查一次脚本状态
- 发现异常退出后等待5秒自动重启
- 记录重启次数和最后输出
- Web界面每30秒自动刷新状态

## 📁 文件结构

```
d:\下载\n1111\
├── cmd_manager.py              # 主程序文件
├── start_cmd_manager.bat       # 一键启动脚本
├── requirements_cmd_manager.txt # Python依赖包列表
├── README_CMD_Manager.md       # 说明文档
├── templates/
│   └── index.html             # Web界面模板
├── logs/                      # 脚本日志目录（自动创建）
├── cmd_config.json           # 脚本配置文件（自动创建）
└── venv/                     # Python虚拟环境（自动创建）
```

## ⚙️ 配置说明

### 系统配置

在 `cmd_manager.py` 中可以修改以下配置：

```python
# 日志配置
LOG_DIR = 'logs'
MAX_LOG_SIZE = 10 * 1024 * 1024  # 10MB
MAX_LOG_FILES = 5
MONITOR_INTERVAL = 5  # 监控间隔（秒）

# 其他配置
CONFIG_FILE = 'cmd_config.json'  # 配置文件
```

### 日志管理

系统采用多层日志管理机制：

**系统日志**：
- 使用 `RotatingFileHandler` 自动轮转
- 单个日志文件最大 10MB
- 保留最近 5 个日志文件
- 日志文件：`logs/cmd_manager.log`

**脚本日志**：
- 内存中保存最近 1000 条日志
- 超过限制时自动保留最后 500 条
- 通过Web界面实时查看
- 支持选择显示行数（50/100/200/500行）

### 脚本配置

脚本配置存储在 `cmd_config.json` 文件中，包含三个主要部分：

```json
{
  "scripts": {
    "script_id": {
      "name": "脚本显示名称",
      "command": "要执行的命令",
      "working_dir": "工作目录",
      "auto_restart": true,
      "enabled": true,
      "description": "脚本描述"
    }
  },
  "groups": {
    "group_id": {
      "name": "分组名称",
      "description": "分组描述",
      "created_at": "创建时间"
    }
  },
  "script_groups": {
    "script_id": "group_id"
  }
}
```

## 🔧 常见问题

### Q: 如何修改Web服务端口？
A: 在 `cmd_manager.py` 文件末尾修改：
```python
app.run(host='0.0.0.0', port=5009, debug=False, threaded=True)
```
将 `port=5009` 改为您需要的端口号。

### Q: 如何让其他电脑访问管理界面？
A: 确保防火墙允许对应端口访问，然后使用服务器IP地址访问，例如：`http://192.168.1.100:5009`

### Q: 脚本日志如何管理？
A: 系统采用智能日志管理：
- 系统日志：自动轮转，单文件最大10MB，保留5个文件
- 脚本日志：内存存储，最多1000条，超出时保留最后500条
- 通过Web界面实时查看，无需手动清理

### Q: 如何备份脚本配置？
A: 备份 `cmd_config.json` 文件即可保存所有脚本配置。

### Q: 脚本无法启动怎么办？
A: 检查以下几点：
1. 命令是否正确
2. 工作目录是否存在
3. 是否有足够的权限
4. 查看日志文件获取详细错误信息

### Q: 如何禁用某个脚本的自动启动？
A: 在 `cmd_config.json` 文件中为该脚本添加 `"enabled": false` 配置：
```json
{
  "scripts": {
    "script_id": {
      "name": "脚本名称",
      "command": "命令",
      "enabled": false
    }
  }
}
```

### Q: 日志文件会占用太多磁盘空间吗？
A: 不会，系统已实现智能日志管理：
- 系统日志自动轮转，最多占用50MB（5个10MB文件）
- 脚本日志存储在内存中，重启后清空
- 无需手动清理，系统自动维护

## 🛡️ 安全建议

1. **网络安全**: 如果需要远程访问，建议使用VPN或设置防火墙规则
2. **权限控制**: 确保运行服务的用户具有适当的权限
3. **定期备份**: 定期备份配置文件和重要日志
4. **监控日志**: 定期检查日志文件，及时发现异常

## 📝 更新日志

### v1.0.0 (2024-01-01)
- 初始版本发布
- 支持基本的脚本管理功能
- 提供Web界面操作
- 实现自动重启机制
- 支持日志查看功能

## 🤝 技术支持

如果您在使用过程中遇到问题，可以：

1. 查看日志文件获取详细错误信息
2. 检查系统配置是否正确
3. 确认Python环境和依赖包是否正常安装

## 📄 许可证

本项目采用 MIT 许可证，您可以自由使用、修改和分发。

---

**享受使用CMD脚本管理器！** 🎉